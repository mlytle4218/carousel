/*! Wed Oct 10 2018 18:00:45 */

var container,fadeInObject,fadeOutObject,inter,camera,scene,renderer,light,imagesArray,rotationRate=-.005,speed=0,radius=430,cameraDistance=1e3,zoomedCameraDistance=800,cameraZoomRate=10,fadeRate=.005,working=0,mouseDown=!1,mouseOver=!1,timeStamp=null,prevMouseX=null,prevMouseY=null,averageX=[0,0],averageY=[0,0],raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,connectingElement="carousel",ambientLightColor=16777215;function start(e){container=document.getElementById(connectingElement),initCar(imagesArray=createImagePlanes(e)),animateCar(),window.addEventListener("mousedown",onMouseDown,!1),window.addEventListener("mouseup",onMouseUp,!1),window.addEventListener("mousemove",onMouseMove,!1),window.addEventListener("mouseover",onMouseOver,!1),window.addEventListener("mouseout",onMouseOff,!1)}function createImagePlanes(e){var t=[],n=[];return e.files.forEach(function(e){n.push(e.pic)}),e.files.forEach(function(r){var e=new THREE.TextureLoader,n=new THREE.MeshLambertMaterial({map:e.load(r.pic)});n.transparent=!0;var a=new THREE.PlaneGeometry(radius,radius),o=new THREE.Mesh(a,n);o.position.set(0,-3,0),o.url=r.url,(e=new THREE.FontLoader).load("fonts/OpenSans-Bold.json",function(e){var n=new THREE.TextGeometry(r.name,{size:25,font:e,height:5,curveSegments:12,bevelEnabled:!1,bevelThickness:10,bevelSize:8,bevelSegments:5}),a=new THREE.MeshPhongMaterial({color:0,opacity:0,specular:16777215});a.transparent=!0;var t=new THREE.Mesh(n,a);t.fade=!1,t.position.set(100,-50,0),o.add(t)}),t.push(o)}),t}function loadObjModel(r){var o;return new Promise(function(a,t){var e=new THREE.MTLLoader;e.setPath(r),e.load(name+".mtl",function(e){e.preload();var n=new THREE.OBJLoader;n.setMaterials(e),n.setPath(r),n.load(name+".obj",a,o,t)},o,t)})}function fade(){imagesArray&&imagesArray.forEach(function(e){e.children[0]&&(e.children[0].fade?e.children[0].material.opacity<1&&(e.children[0].material.opacity+=fadeRate):0<e.children[0].material.opacity&&(e.children[0].material.opacity-=fadeRate))})}function fadeIn(e){}function fadeOut(e){}function initCar(e){(camera=new THREE.PerspectiveCamera(45,container.clientWidth/container.clientHeight,1,2e3)).position.set(0,-2,cameraDistance),mouse=new THREE.Vector2,scene=new THREE.Scene,(light=new THREE.AmbientLight(ambientLightColor)).position.set(0,10,0),scene.add(light),parent=new THREE.Object3D,scene.add(parent);for(var n=0,a=0;a<e.length;a++){var t=new THREE.Object3D;t.rotation.y=n*Math.PI/e.length,parent.add(t),e[a].position.z=400,e[a].rotation.y=-n*Math.PI/e.length,t.add(e[a]),n+=2}this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(container.clientWidth,container.clientHeight),renderer.gammaOutput=!0,container.appendChild(renderer.domElement)}function onWindowResize(){camera.aspect=container.clientWidth/container.clientHeight,camera.updateProjectionMatrix(),renderer.setSize(container.clientWidth,container.clientHeight)}function animateCar(){var e=Math.round(scene.children[1].rotation.y/(Math.PI/2));console.log(scene.children[1].rotation.y/(Math.PI/2)-Math.floor(scene.children[1].rotation.y/(Math.PI/2))),e%4==0&&(working=0),working++;var n=0;if(n=e<=0?-1:1,imagesArray&&imagesArray[Math.abs(e)%4].children[0]&&imagesArray[Math.abs(e)%4].children[0].material)if(n<0){var a=Math.round(scene.children[1].rotation.y/(Math.PI/2));imagesArray.forEach(function(e){e.children[0].fade=!1}),imagesArray[Math.abs(a)%4].children[0].fade=!0}else{var t=Math.round(scene.children[1].rotation.y/(Math.PI/2)+.5);imagesArray.forEach(function(e){e.children[0].fade=!1}),imagesArray[[0,3,2,1][Math.abs(t)%4]].children[0].fade=!0}fadeIn(fadeInObject),fadeOut(fadeOutObject),fade(),requestAnimationFrame(animateCar),renderer.render(scene,camera),(speed<1e-4||1e-4<speed)&&(speed*=.99),mouseOver?(rotateParent(getRotationRate()/2),camera.position.z>zoomedCameraDistance&&(camera.position.z-=cameraZoomRate)):(rotateParent(getRotationRate()),camera.position.z<cameraDistance&&(camera.position.z+=cameraZoomRate))}function onMouseDown(e){if(inContainer(e)){mouseDown=!0,averageX=[0,0],averageY=[0,0],e.preventDefault(),raycaster.setFromCamera(mouse,camera);var n=raycaster.intersectObjects(scene.children,!0);0<n.length&&(inter=n[0])}}function onMouseUp(e){mouseDown=!1}function onMouseMove(e){if(mouseDown&inContainer(e)){if(null===timeStamp)return timeStamp=Date.now(),prevMouseX=e.clientX,void(prevMouseY=e.clientY);var n=Date.now(),a=n-timeStamp,t=e.clientX-prevMouseX,r=Math.round(t/a*100);averageX[0]+=r,averageX[1]++,timeStamp=n,prevMouseX=e.clientX,prevMouseY=e.clientY,(speed=averageX[0]/averageX[1]/1e3*.1)*rotationRate<0&&(rotationRate*=-1)}}function rotateParent(e){parent.rotation.y+=e;for(var n=0;n<parent.children.length;n++)parent.children[n].children[0].rotation.y+=-e}function toRadians(e){return e*(Math.PI/180)}function onMouseOver(e){mouseOver=!!inContainer(e)}function inContainer(e){return!!(e.clientX>container.offsetLeft&e.clientX<container.offsetLeft+container.clientWidth&&e.clientY>container.offsetTop&e.clientY<container.offsetTop+container.clientHeight)}function onMouseOff(e){mouseOver=!1}function getRotationRate(){return mouseDown?0:speed*rotationRate<0?-rotationRate+speed:rotationRate+speed}window.addEventListener("resize",onWindowResize,!1);